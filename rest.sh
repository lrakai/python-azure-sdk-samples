#!/usr/bin/env bash

set -x 

subscription="c460cd3f-7c2a-48cc-9f5d-b62d6083ec23"
resource_group="cal-456-23"
provider="Microsoft.Sql"
api_version="2021-02-01-preview"
local_token="eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6Im5PbzNaRHJPRFhFSzFqS1doWHNsSFJfS1hFZyIsImtpZCI6Im5PbzNaRHJPRFhFSzFqS1doWHNsSFJfS1hFZyJ9.eyJhdWQiOiJodHRwczovL21hbmFnZW1lbnQuY29yZS53aW5kb3dzLm5ldC8iLCJpc3MiOiJodHRwczovL3N0cy53aW5kb3dzLm5ldC9mZDFmYmY5Zi05OTFhLTQwYjQtYWUyNi02MWRmYzM0NDIxZWYvIiwiaWF0IjoxNjIxNjM2MzY3LCJuYmYiOjE2MjE2MzYzNjcsImV4cCI6MTYyMTY0MDI2NywiYWlvIjoiRTJaZ1lOQi91THN5MlBXbjYxdjlQUjFuSC9zRUFRQT0iLCJhcHBpZCI6IjE5MjNhZmU0LWIxNmMtNDAyMi1hNjU2LTk2MzljNDQ0YTFlMCIsImFwcGlkYWNyIjoiMSIsImdyb3VwcyI6WyI2ZDk1NjY0ZC0xYjc4LTQ2NGItYTViMC00OGYyOTExMzFjNmYiLCJkMzUzOTNjNy02NWRmLTQ0ZDctOTE2Ni1jMDVmYTdjYTRlNTciLCI5MjgzZWU3Yi0yYjU3LTRmNjItOWMxMS1kZTQwNWNhZjhjM2QiLCJmNWQ2ZDI4ZS00N2UyLTRmNmEtOTUzMi04NGZkYjQ1ZjUzYjUiLCJhZGQ2YjYzNS05YzEzLTQxMmEtOGQ0ZC1kMGZiYjk4MWZjODkiXSwiaWRwIjoiaHR0cHM6Ly9zdHMud2luZG93cy5uZXQvZmQxZmJmOWYtOTkxYS00MGI0LWFlMjYtNjFkZmMzNDQyMWVmLyIsIm9pZCI6ImU5MWZlZWQ3LTc2NTctNGM0MS05NmEzLWFiNTMzZTAwZGUyYSIsInJoIjoiMC5BUmdBbjc4Zl9ScVp0RUN1Sm1IZncwUWg3LVN2SXhsc3NTSkFwbGFXT2NSRW9lQVlBQUEuIiwic3ViIjoiZTkxZmVlZDctNzY1Ny00YzQxLTk2YTMtYWI1MzNlMDBkZTJhIiwidGlkIjoiZmQxZmJmOWYtOTkxYS00MGI0LWFlMjYtNjFkZmMzNDQyMWVmIiwidXRpIjoieUJzUks4Y2NYRXlMR3RwNzctcklBQSIsInZlciI6IjEuMCIsInhtc190Y2R0IjoxNDUzMjg5ODI1fQ.D4mmP3uPfgcUJyAgemG-vnSJTVXaNd9aAXtxj4oCe6i1itb00WFQZDdaH5deQnhm0lZAJCk-jJ6w1ygNkXcIS6bl8qtkLyGpQCic4ONG8_G15mirgBrXt-Fqub94EAfug2ezA5mp-e2CANepa29e5HUgVm3TMJ9ObZZVxB5rFdVfU0bYq7OgeJY4_1X-LwRh34MXwDr-e2VtjrJmGFVPCrQjz2E6dVyQqSweBHOdBQ6_cTwuPJexdMkH49CVpUfOerdWaD3_yRODGkVwnB4RGK1p0ep-7_CryXPA5h86Y-MJ_eVbZW-FYWb1BTsw5JzpyBqcYWjJpuv-lY-R3hLWnA"
remote_token="eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6Im5PbzNaRHJPRFhFSzFqS1doWHNsSFJfS1hFZyIsImtpZCI6Im5PbzNaRHJPRFhFSzFqS1doWHNsSFJfS1hFZyJ9.eyJhdWQiOiJodHRwczovL21hbmFnZW1lbnQuY29yZS53aW5kb3dzLm5ldC8iLCJpc3MiOiJodHRwczovL3N0cy53aW5kb3dzLm5ldC9mZDFmYmY5Zi05OTFhLTQwYjQtYWUyNi02MWRmYzM0NDIxZWYvIiwiaWF0IjoxNjIxNjU3NTQ3LCJuYmYiOjE2MjE2NTc1NDcsImV4cCI6MTYyMTY2MTQ0NywiYWlvIjoiRTJaZ1lOakp5ZGltcXpoN2wwTGhoN25zQ2k2ekFRPT0iLCJhcHBpZCI6IjE5MjNhZmU0LWIxNmMtNDAyMi1hNjU2LTk2MzljNDQ0YTFlMCIsImFwcGlkYWNyIjoiMSIsImdyb3VwcyI6WyI2ZDk1NjY0ZC0xYjc4LTQ2NGItYTViMC00OGYyOTExMzFjNmYiLCJkMzUzOTNjNy02NWRmLTQ0ZDctOTE2Ni1jMDVmYTdjYTRlNTciLCI5MjgzZWU3Yi0yYjU3LTRmNjItOWMxMS1kZTQwNWNhZjhjM2QiLCJmNWQ2ZDI4ZS00N2UyLTRmNmEtOTUzMi04NGZkYjQ1ZjUzYjUiLCJhZGQ2YjYzNS05YzEzLTQxMmEtOGQ0ZC1kMGZiYjk4MWZjODkiXSwiaWRwIjoiaHR0cHM6Ly9zdHMud2luZG93cy5uZXQvZmQxZmJmOWYtOTkxYS00MGI0LWFlMjYtNjFkZmMzNDQyMWVmLyIsIm9pZCI6ImU5MWZlZWQ3LTc2NTctNGM0MS05NmEzLWFiNTMzZTAwZGUyYSIsInJoIjoiMC5BUmdBbjc4Zl9ScVp0RUN1Sm1IZncwUWg3LVN2SXhsc3NTSkFwbGFXT2NSRW9lQVlBQUEuIiwic3ViIjoiZTkxZmVlZDctNzY1Ny00YzQxLTk2YTMtYWI1MzNlMDBkZTJhIiwidGlkIjoiZmQxZmJmOWYtOTkxYS00MGI0LWFlMjYtNjFkZmMzNDQyMWVmIiwidXRpIjoibE9XMnVPZy1zRXVBeTcyei0zcmlBQSIsInZlciI6IjEuMCIsInhtc190Y2R0IjoxNDUzMjg5ODI1fQ.P2JtmCBZ3eq14A8AeI8zcKhVg1umDnCTMifvHJkKQsJ8MBV66o9Ny5TXmbwvdGheKcU3RbE1dd-0bDVVfY3TFwF_QAKJoSjBHFeN22sh_BwKJP_pDEXh4M4QmmzPY-IAtoEksl0dneAOHAaUaq6BQffZILAjOr7SXF3NquaZm6wwjWAUni95jYPuAhM_iQD1Bamhuh1FxX1uOQk9BD26PUxO80PftiD8_Uc4Kw0sWKzKjhyifS7qWtI2gOnCPKsRfqK4ec-pHFBqpsQDu_x487ciz8bXYjkIe5pgi3ZoU1ijQiBU4P01pY3MUQRxau2ac5fKD6Y-vDKOPRPiA8EHTA"
use_local=0
token=$(if [ $use_local -eq 1 ]; then echo "local_token"; else echo "remote_token"; fi)
curl -XGET -H "Authorization: Bearer $(eval echo \$$token)" https://management.azure.com/subscriptions/$subscription/resourceGroups/$resource_group/providers/$provider/servers?api-version=$api_version